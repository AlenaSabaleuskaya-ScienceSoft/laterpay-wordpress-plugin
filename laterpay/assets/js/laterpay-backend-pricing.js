!function(a){a(function(){function b(){var b={revenueModel:".lp_js_revenue-model",revenueModelLabel:".lp_js_revenue-model-label",revenueModelLabelDisplay:".lp_js_revenue-model-label-display",revenueModelInput:".lp_js_revenue-model-input",priceInput:".lp_js_price-input",globalDefaultPriceForm:a("#lp_js_global-default-price-form"),globalDefaultPriceInput:a("#lp_js_global-default-price"),globalDefaultPriceDisplay:a("#lp_js_global-default-price-text"),globalDefaultPriceRevenueModelDisplay:a("#lp_js_global-default-price-revenue-model-label"),editGlobalDefaultPrice:a("#lp_js_edit-global-default-price"),cancelEditingGlobalDefaultPrice:a("#lp_js_cancel-editing-global-default-price"),saveGlobalDefaultPrice:a("#lp_js_save-global-default-price"),globalDefaultPriceShowElements:a("#lp_js_global-default-price-text,#lp_js_edit-global-default-price,#lp_js_global-default-price-revenue-model-label"),globalDefaultPriceEditElements:a("#lp_js_global-default-price,#lp_js_global-default-price-revenue-model,#lp_js_cancel-editing-global-default-price,#lp_js_save-global-default-price"),categoryDefaultPrices:a("#lp_js_category-default-prices-list"),addCategory:a("#lp_js_add-category-default-price"),categoryDefaultPriceTemplate:a("#lp_js_category-default-price-template"),categoryDefaultPriceForm:".lp_js_category-default-price-form",editCategoryDefaultPrice:".lp_js_edit-category-default-price",cancelEditingCategoryDefaultPrice:".lp_js_cancel-editing-category-default-price",saveCategoryDefaultPrice:".lp_js_save-category-default-price",deleteCategoryDefaultPrice:".lp_js_delete-category-default-price",categoryDefaultPriceShowElements:".lp_js_category-title,.lp_js_revenue-model-label-display,.lp_js_category-default-price-display,.lp_js_edit-category-default-price,.lp_js_delete-category-default-price",categoryDefaultPriceEditElements:".lp_js_category-default-price-input,.lp_js_revenue-model,.lp_js_save-category-default-price,.lp_js_cancel-editing-category-default-price",categoryTitle:".lp_js_category-title",categoryDefaultPriceDisplay:".lp_js_category-default-price-display",selectCategory:".lp_js_select-category",categoryDefaultPriceInput:".lp_js_category-default-price-input",categoryId:".lp_js_category-id",bulkPriceForm:a("#lp_js_bulk-price-form"),bulkPriceAction:a("#lp_js_change-bulk-action"),bulkPriceObjects:a("#lp_js_select-bulk-objects"),bulkPriceObjectsCategory:a("#lp_js_select-bulk-objects-category"),bulkPriceObjectsCategoryWithPrice:a("#lp_js_select-bulk-objects-category-with-price"),bulkPriceChangeAmountPreposition:a("#lp_js_bulk-amount-preposition"),bulkPriceChangeAmount:a("#lp_js_set-bulk-change-amount"),bulkPriceChangeUnit:a("#lp_js_set-bulk-change-unit"),bulkPriceSubmit:a("#lp_js_apply-bulk-operation"),bulkSaveOperationLink:a("#lp_js_save-bulk-operation"),bulkDeleteOperationLink:".lp_js_delete-saved-bulk-operation",bulkApplySavedOperationLink:".lp_js_apply-saved-bulk-operation",bulkPriceFormHiddenField:a("#lp_js_bulk-price-form-hidden"),bulkPriceOperationIdHiddenField:a("#lp_js_bulk-operation-id-hidden"),bulkPriceMessageHiddenField:a("#lp_js_bulk-message-hidden"),defaultCurrencyForm:a("#lp_js_default-currency-form"),defaultCurrency:a("#lp_js_change-default-currency"),currency:".lp_js_currency",editing:"lp_is_editing",unsaved:"lp_is_unsaved",payPerUse:"ppu",singleSale:"sis",selected:"lp_is-selected",disabled:"lp_is-disabled"},c=function(){a("body").on("change",b.revenueModelInput,function(){d(a(this).parents("form"))}),a("body").on("keyup",b.priceInput,q(function(){d(a(this).parents("form"))},800)),b.editGlobalDefaultPrice.mousedown(function(){f()}).click(function(a){a.preventDefault()}),b.cancelEditingGlobalDefaultPrice.mousedown(function(){g()}).click(function(a){a.preventDefault()}),b.saveGlobalDefaultPrice.mousedown(function(){h()}).click(function(a){a.preventDefault()}),b.addCategory.mousedown(function(){i()}).click(function(a){a.preventDefault()}),b.categoryDefaultPrices.on("click",b.editCategoryDefaultPrice,function(){var c=a(this).parents(b.categoryDefaultPriceForm);j(c)}),b.categoryDefaultPrices.on("click",b.cancelEditingCategoryDefaultPrice,function(){var c=a(this).parents(b.categoryDefaultPriceForm);l(c)}),b.categoryDefaultPrices.on("click",b.saveCategoryDefaultPrice,function(){var c=a(this).parents(b.categoryDefaultPriceForm);k(c)}),b.categoryDefaultPrices.on("click",b.deleteCategoryDefaultPrice,function(){var c=a(this).parents(b.categoryDefaultPriceForm);m(c)}),b.bulkPriceAction.add(b.bulkPriceObjects).on("change",function(){t(b.bulkPriceAction.val(),b.bulkPriceObjects.val())}),b.bulkPriceObjectsCategoryWithPrice.on("change",function(){b.bulkPriceChangeAmountPreposition.text(lpVars.i18n.toCategoryDefaultPrice+" "+b.bulkPriceObjectsCategoryWithPrice.find(":selected").attr("data-price")+" "+lpVars.defaultCurrency)}),b.bulkPriceForm.on("submit",function(a){b.bulkPriceFormHiddenField.val("bulk_price_form"),b.bulkPriceOperationIdHiddenField.val(void 0),b.bulkPriceMessageHiddenField.val(void 0),r(),a.preventDefault()}),b.bulkSaveOperationLink.mousedown(function(){v()}).click(function(a){a.preventDefault()}),a("body").on("mousedown",b.bulkApplySavedOperationLink,function(){w(a(this).parent())}).on("click",b.bulkApplySavedOperationLink,function(a){a.preventDefault()}),a("body").on("mousedown",b.bulkDeleteOperationLink,function(){x(a(this).parent())}).on("click",b.bulkDeleteOperationLink,function(a){a.preventDefault()}),b.defaultCurrency.change(function(){p()})},d=function(b){var f,c=a(".lp_number-input",b),d=c.val();return d=d.replace(/[^0-9\,\.]/g,""),d=d.indexOf(",")>-1?parseFloat(d.replace(",",".")).toFixed(2):parseFloat(d).toFixed(2),isNaN(d)&&(d=0,f=!0),d=Math.abs(d),d>149.99?(d=149.99,f=!0):d>0&&.05>d&&(d=.05,f=!0),e(d,b),d=d.toFixed(2),"de_DE"===lpVars.locale&&(d=d.replace(".",",")),c.val(d),d},e=function(c,d){var e=a("input:radio:checked",d).val(),f=a(".lp_js_revenue-model-input[value="+b.payPerUse+"]",d),g=a(".lp_js_revenue-model-input[value="+b.singleSale+"]",d);0===c||c>=.05&&5>=c?f.removeProp("disabled").parent("label").removeClass(b.disabled):f.prop("disabled","disabled").parent("label").addClass(b.disabled),c>=1.49?g.removeProp("disabled").parent("label").removeClass(b.disabled):g.prop("disabled","disabled").parent("label").addClass(b.disabled),c>5&&e===b.payPerUse?g.prop("checked","checked"):1.49>c&&e===b.singleSale&&f.prop("checked","checked"),a("label",d).removeClass(b.selected),a(".lp_js_revenue-model-input:checked",d).parent("label").addClass(b.selected)},f=function(){b.globalDefaultPriceShowElements.hide(),b.globalDefaultPriceEditElements.show(0,function(){setTimeout(function(){b.globalDefaultPriceInput.val(b.globalDefaultPriceDisplay.text()).focus()},50)}),b.globalDefaultPriceForm.addClass(b.editing)},g=function(){b.globalDefaultPriceShowElements.show(),b.globalDefaultPriceEditElements.hide(),b.globalDefaultPriceForm.removeClass(b.editing),b.globalDefaultPriceInput.val(b.globalDefaultPriceDisplay.text());var c=b.globalDefaultPriceRevenueModelDisplay.text().toLowerCase();a(b.revenueModelLabel,b.globalDefaultPriceForm).removeClass(b.selected),a(".lp_js_revenue-model-input[value="+c+"]",b.globalDefaultPriceForm).prop("checked","checked").parent("label").addClass(b.selected)},h=function(){var c=d(b.globalDefaultPriceForm);b.globalDefaultPriceInput.val(c),a.post(ajaxurl,b.globalDefaultPriceForm.serializeArray(),function(a){a.success&&(b.globalDefaultPriceDisplay.html(a.laterpay_global_price),b.globalDefaultPriceRevenueModelDisplay.text(a.laterpay_price_revenue_model)),setMessage(a.message,a.success),g()},"json")},i=function(){b.addCategory.fadeOut(250);var a=b.categoryDefaultPriceTemplate.clone().removeAttr("id").appendTo("#lp_js_category-default-prices-list").fadeIn(250);j(a)},j=function(c){a(".lp_js_category-default-price-form.lp_is_editing").each(function(){l(a(this),!0)}),c.addClass(b.editing),a(b.categoryDefaultPriceShowElements,c).hide(),b.addCategory.fadeOut(250),a(b.categoryDefaultPriceEditElements,c).show(),o(c)},k=function(c){var e=d(c);a(b.categoryDefaultPriceInput,c).val(e),a.post(ajaxurl,c.serializeArray(),function(d){d.success&&(a(b.categoryDefaultPriceDisplay,c).text(d.price),a(b.revenueModelLabelDisplay,c).text(d.revenue_model),a(b.categoryDefaultPriceInput,c).val(d.price),a(b.categoryTitle,c).text(d.category),a(b.categoryId,c).val(d.category_id),c.removeClass(b.unsaved)),l(c),setMessage(d.message,d.success)},"json")},l=function(c,d){if(c.removeClass(b.editing),c.hasClass(b.unsaved))c.fadeOut(250,function(){a(this).remove()});else{a(b.categoryDefaultPriceEditElements,c).hide(),a(b.selectCategory,c).select2("destroy"),a(b.categoryDefaultPriceInput,c).val(a(b.categoryDefaultPriceDisplay,c).text());var e=a(b.revenueModelLabelDisplay,c).text().toLowerCase();a(b.revenueModelLabel,c).removeClass(b.selected),a(".lp_js_revenue-model-input[value="+e+"]",c).prop("checked","checked").parent("label").addClass(b.selected),a(b.categoryDefaultPriceShowElements,c).show()}d||b.addCategory.fadeIn(250)},m=function(b){a("input[name=form]",b).val("price_category_form_delete"),a.post(ajaxurl,b.serializeArray(),function(c){c.success&&b.fadeOut(400,function(){a(this).remove()}),setMessage(c.message,c.success)},"json")},n=function(b,c){var d=a(c).parent().parent().parent();return a(".lp_js_select-category",d).val(b.text),a(".lp_js_category-id",d).val(b.id),b.text},o=function(c){a(b.selectCategory,c).select2({allowClear:!0,ajax:{url:ajaxurl,data:function(a){return{term:a,action:"laterpay_pricing"}},results:function(b){var c=[];return a.each(b,function(a){var d=b[a];c.push({id:d.term_id,text:d.name})}),{results:c}},dataType:"json"},initSelection:function(b,c){var d=a(b).val();if(""!==d){var e={text:d};c(e)}else a.get(ajaxurl,{term:"",action:"laterpay_pricing"},function(a){if(console.log(a),a&&void 0!==a[0]){var b=a[0];c({text:b.name})}})},formatResult:function(a){return a.text},formatSelection:n,escapeMarkup:function(a){return a}})},p=function(){a.post(ajaxurl,b.defaultCurrencyForm.serializeArray(),function(c){c.success&&a(b.currency).html(c.laterpay_currency),setMessage(c.message,c.success)},"json")},q=function(a,b){var c;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}},r=function(c){a.post(ajaxurl,c||b.bulkPriceForm.serializeArray(),function(a){setMessage(a.message,a.success)},"json")},s=function(c){b.bulkPriceObjects.append(a("<option>",{value:"in_category",text:lpVars.inCategoryLabel,selected:!!c}))},t=function(c,d){var e="in_category"===d;switch(b.bulkPriceChangeUnit.find("option").each(function(){"%"===a(this).text()&&a(this).remove()}).end().addClass(b.disabled),b.bulkPriceObjects.find("option").each(function(){"in_category"===a(this).val()&&a(this).remove()}),b.bulkPriceObjectsCategory.prop("disabled",!0).hide(),b.bulkPriceObjectsCategoryWithPrice.prop("disabled",!0).hide(),b.bulkPriceChangeAmountPreposition.hide(),b.bulkPriceChangeAmount.prop("disabled",!0).hide(),b.bulkPriceChangeUnit.prop("disabled",!0).hide(),c){case"set":b.bulkPriceChangeAmountPreposition.show().text(lpVars.i18n.to),b.bulkPriceChangeAmount.prop("disabled",!1).show(),b.bulkPriceChangeUnit.show();break;case"increase":case"reduce":b.bulkPriceChangeAmountPreposition.show().text(lpVars.i18n.by),b.bulkPriceChangeAmount.prop("disabled",!1).show(),b.bulkPriceChangeUnit.prop("disabled",!1).show(),b.bulkPriceChangeUnit.removeClass(b.disabled).append(a("<option>",{value:"percent",text:"%"}));break;case"free":b.bulkPriceObjectsCategory.length&&(s(e),e&&b.bulkPriceObjectsCategory.prop("disabled",!1).show());break;case"reset":b.bulkPriceChangeAmountPreposition.text(lpVars.i18n.toGlobalDefaultPrice+" "+lpVars.globalDefaultPrice+" "+lpVars.defaultCurrency),b.bulkPriceObjectsCategoryWithPrice.length&&(s(e),e&&b.bulkPriceObjectsCategoryWithPrice.prop("disabled",!1).show().change()),b.bulkPriceChangeAmountPreposition.show()}},u=function(a,c){var d='<p class="lp_bulk-operation" data-value="'+a+'">'+'<a href="#" class="lp_js_delete-saved-bulk-operation lp_edit-link lp_delete-link" data-icon="g">'+lpVars.i18n.delete+"</a>"+'<a href="#" class="lp_js_apply-saved-bulk-operation button button-primary lp_m-l2">'+lpVars.i18n.updatePrices+"</a>"+"<span>"+c+"</span>"+"</p>";b.bulkPriceForm.after(d)},v=function(){var c="Make free"===a.trim(b.bulkPriceAction.find("option:selected").text())?"Make":b.bulkPriceAction.find("option:selected").text(),d=b.bulkPriceObjects.find("option:selected").text().toLowerCase(),e="All posts"===a.trim(b.bulkPriceObjects.find("option:selected").text())?"":'"'+a.trim(b.bulkPriceObjectsCategory.find("option:selected").text())+'"',f="Make free"===a.trim(b.bulkPriceAction.find("option:selected").text())?"":b.bulkPriceChangeAmountPreposition.text(),g="Make free"===a.trim(b.bulkPriceAction.find("option:selected").text())?"":b.bulkPriceChangeAmount.val()+b.bulkPriceChangeUnit.find("option:selected").text(),h="Make free"===a.trim(b.bulkPriceAction.find("option:selected").text())?"free":"",i=[c,d,e,f,g,h];i=a.trim(i.join(" ").replace(/\s+/g," ")),b.bulkPriceFormHiddenField.val("bulk_price_form_save"),b.bulkPriceOperationIdHiddenField.val(void 0),b.bulkPriceMessageHiddenField.val(i),a.post(ajaxurl,b.bulkPriceForm.serializeArray(),function(a){a.success&&u(a.data.id,a.data.message),setMessage(a.message,a.success)},"json")},w=function(a){b.bulkPriceFormHiddenField.val("bulk_price_form"),b.bulkPriceOperationIdHiddenField.val(a.data("value")),r()},x=function(c){b.bulkPriceFormHiddenField.val("bulk_price_form_delete"),b.bulkPriceOperationIdHiddenField.val(c.data("value")),a.post(ajaxurl,b.bulkPriceForm.serializeArray(),function(a){a.success&&c.fadeOut(250,function(){c.remove()}),setMessage(a.message,a.success)},"json")},y=function(){c(),b.bulkPriceAction.change()};y()}b()})}(jQuery);
