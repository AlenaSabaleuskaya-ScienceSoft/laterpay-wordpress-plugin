(function(e){e(function(){function t(){var t={revenueModel:".lp_js_revenue-model",revenueModelLabel:".lp_js_revenue-model-label",revenueModelLabelDisplay:".lp_js_revenue-model-label-display",revenueModelInput:".lp_js_revenue-model-input",priceInput:".lp_js_price-input",globalDefaultPriceForm:e("#lp_js_global-default-price-form"),globalDefaultPriceInput:e("#lp_js_global-default-price"),globalDefaultPriceDisplay:e("#lp_js_global-default-price-text"),globalDefaultPriceRevenueModelDisplay:e("#lp_js_global-default-price-revenue-model-label"),editGlobalDefaultPrice:e("#lp_js_edit-global-default-price"),cancelEditingGlobalDefaultPrice:e("#lp_js_cancel-editing-global-default-price"),saveGlobalDefaultPrice:e("#lp_js_save-global-default-price"),globalDefaultPriceShowElements:e("#lp_js_global-default-price-text,"+"#lp_js_edit-global-default-price,"+"#lp_js_global-default-price-revenue-model-label"),globalDefaultPriceEditElements:e("#lp_js_global-default-price,"+"#lp_js_global-default-price-revenue-model,"+"#lp_js_cancel-editing-global-default-price,"+"#lp_js_save-global-default-price"),categoryDefaultPrices:e("#lp_js_category-default-prices-list"),addCategory:e("#lp_js_add-category-default-price"),categoryDefaultPriceTemplate:e("#lp_js_category-default-price-template"),categoryDefaultPriceForm:".lp_js_category-default-price-form",editCategoryDefaultPrice:".lp_js_edit-category-default-price",cancelEditingCategoryDefaultPrice:".lp_js_cancel-editing-category-default-price",saveCategoryDefaultPrice:".lp_js_save-category-default-price",deleteCategoryDefaultPrice:".lp_js_delete-category-default-price",categoryDefaultPriceShowElements:".lp_js_category-title,"+".lp_js_revenue-model-label-display,"+".lp_js_category-default-price-display,"+".lp_js_edit-category-default-price,"+".lp_js_delete-category-default-price",categoryDefaultPriceEditElements:".lp_js_category-default-price-input,"+".lp_js_revenue-model,"+".lp_js_save-category-default-price,"+".lp_js_cancel-editing-category-default-price",categoryTitle:".lp_js_category-title",categoryDefaultPriceDisplay:".lp_js_category-default-price-display",selectCategory:".lp_js_select-category",categoryDefaultPriceInput:".lp_js_category-default-price-input",categoryId:".lp_js_category-id",bulkPriceForm:e("#lp_js_bulk-price-form"),bulkPriceAction:e("#lp_js_change-bulk-action"),bulkPriceObjects:e("#lp_js_select-bulk-objects"),bulkPriceObjectsCategory:e("#lp_js_select-bulk-objects-category"),bulkPriceObjectsCategoryWithPrice:e("#lp_js_select-bulk-objects-category-with-price"),bulkPriceChangeAmountPreposition:e("#lp_js_bulk-amount-preposition"),bulkPriceChangeAmount:e("#lp_js_set-bulk-change-amount"),bulkPriceChangeUnit:e("#lp_js_set-bulk-change-unit"),bulkPriceSubmit:e("#lp_js_apply-bulk-operation"),bulkSaveOperationLink:e("#lp_js_save-bulk-operation"),bulkDeleteOperationLink:".lp_js_delete-saved-bulk-operation",bulkApplySavedOperationLink:".lp_js_apply-saved-bulk-operation",defaultCurrencyForm:e("#lp_js_default-currency-form"),defaultCurrency:e("#lp_js_change-default-currency"),currency:".lp_js_currency",editing:"lp_is_editing",unsaved:"lp_is_unsaved",payPerUse:"ppu",singleSale:"sis",selected:"lp_is-selected",disabled:"lp_is-disabled"},n=function(){e("body").on("change",t.revenueModelInput,function(){r(e(this).parents("form"))});e("body").on("keyup",t.priceInput,m(function(){r(e(this).parents("form"))},800));t.editGlobalDefaultPrice.mousedown(function(){s()}).click(function(e){e.preventDefault()});t.cancelEditingGlobalDefaultPrice.mousedown(function(){o()}).click(function(e){e.preventDefault()});t.saveGlobalDefaultPrice.mousedown(function(){u()}).click(function(e){e.preventDefault()});t.addCategory.mousedown(function(){a()}).click(function(e){e.preventDefault()});t.categoryDefaultPrices.on("click",t.editCategoryDefaultPrice,function(){var n=e(this).parents(t.categoryDefaultPriceForm);f(n)});t.categoryDefaultPrices.on("click",t.cancelEditingCategoryDefaultPrice,function(){var n=e(this).parents(t.categoryDefaultPriceForm);c(n)});t.categoryDefaultPrices.on("click",t.saveCategoryDefaultPrice,function(){var n=e(this).parents(t.categoryDefaultPriceForm);l(n)});t.categoryDefaultPrices.on("click",t.deleteCategoryDefaultPrice,function(){var n=e(this).parents(t.categoryDefaultPriceForm);h(n)});t.bulkPriceAction.add(t.bulkPriceObjects).on("change",function(){b(t.bulkPriceAction.val(),t.bulkPriceObjects.val())});t.bulkPriceObjectsCategoryWithPrice.on("change",function(){t.bulkPriceChangeAmountPreposition.text(lpVars.i18n.toCategoryDefaultPrice+" "+t.bulkPriceObjectsCategoryWithPrice.find(":selected").attr("data-price")+" "+lpVars.defaultCurrency)});t.bulkPriceForm.on("submit",function(n){e("input[name=form]",t.bulkPriceForm).val("bulk_price_form");e("input[name=bulk_operation_id]",t.bulkPriceForm).val(undefined);e("input[name=bulk_message]",t.bulkPriceForm).val(undefined);g();n.preventDefault()});t.bulkSaveOperationLink.mousedown(function(){E()}).click(function(e){e.preventDefault()});e("body").on("mousedown",t.bulkApplySavedOperationLink,function(){S(e(this).parent())}).on("click",t.bulkApplySavedOperationLink,function(e){e.preventDefault()});e("body").on("mousedown",t.bulkDeleteOperationLink,function(){x(e(this).parent())}).on("click",t.bulkDeleteOperationLink,function(e){e.preventDefault()});t.defaultCurrency.change(function(){v()})},r=function(t){var n=e(".lp_number-input",t),r=n.val(),s;r=r.replace(/[^0-9\,\.]/g,"");if(r.indexOf(",")>-1){r=parseFloat(r.replace(",",".")).toFixed(2)}else{r=parseFloat(r).toFixed(2)}if(isNaN(r)){r=0;s=true}r=Math.abs(r);if(r>149.99){r=149.99;s=true}else if(r>0&&r<.05){r=.05;s=true}i(r,t);r=r.toFixed(2);if(lpVars.locale==="de_DE"){r=r.replace(".",",")}n.val(r);return r},i=function(n,r){var i=e("input:radio:checked",r).val(),s=e(".lp_js_revenue-model-input[value="+t.payPerUse+"]",r),o=e(".lp_js_revenue-model-input[value="+t.singleSale+"]",r);if(n===0||n>=.05&&n<=5){s.removeProp("disabled").parent("label").removeClass(t.disabled)}else{s.prop("disabled","disabled").parent("label").addClass(t.disabled)}if(n>=1.49){o.removeProp("disabled").parent("label").removeClass(t.disabled)}else{o.prop("disabled","disabled").parent("label").addClass(t.disabled)}if(n>5&&i===t.payPerUse){o.prop("checked","checked")}else if(n<1.49&&i===t.singleSale){s.prop("checked","checked")}e("label",r).removeClass(t.selected);e(".lp_js_revenue-model-input:checked",r).parent("label").addClass(t.selected)},s=function(){t.globalDefaultPriceShowElements.hide();t.globalDefaultPriceEditElements.show(0,function(){setTimeout(function(){t.globalDefaultPriceInput.val(t.globalDefaultPriceDisplay.text()).focus()},50)});t.globalDefaultPriceForm.addClass(t.editing)},o=function(){t.globalDefaultPriceShowElements.show();t.globalDefaultPriceEditElements.hide();t.globalDefaultPriceForm.removeClass(t.editing);t.globalDefaultPriceInput.val(t.globalDefaultPriceDisplay.text());var n=t.globalDefaultPriceRevenueModelDisplay.text().toLowerCase();e(t.revenueModelLabel,t.globalDefaultPriceForm).removeClass(t.selected);e(".lp_js_revenue-model-input[value="+n+"]",t.globalDefaultPriceForm).prop("checked","checked").parent("label").addClass(t.selected)},u=function(){var n=r(t.globalDefaultPriceForm);t.globalDefaultPriceInput.val(n);e.post(ajaxurl,t.globalDefaultPriceForm.serializeArray(),function(e){if(e.success){t.globalDefaultPriceDisplay.html(e.laterpay_global_price);t.globalDefaultPriceRevenueModelDisplay.text(e.laterpay_price_revenue_model)}setMessage(e.message,e.success);o()},"json")},a=function(){t.addCategory.fadeOut(250);var e=t.categoryDefaultPriceTemplate.clone().removeAttr("id").appendTo("#lp_js_category-default-prices-list").fadeIn(250);f(e)},f=function(n){e(".lp_js_category-default-price-form.lp_is_editing").each(function(){c(e(this),true)});n.addClass(t.editing);e(t.categoryDefaultPriceShowElements,n).hide();t.addCategory.fadeOut(250);e(t.categoryDefaultPriceEditElements,n).show();d(n)},l=function(n){var i=r(n);e(t.categoryDefaultPriceInput,n).val(i);e.post(ajaxurl,n.serializeArray(),function(r){if(r.success){e(t.categoryDefaultPriceDisplay,n).text(r.price);e(t.revenueModelLabelDisplay,n).text(r.revenue_model);e(t.categoryDefaultPriceInput,n).val(r.price);e(t.categoryTitle,n).text(r.category);e(t.categoryId,n).val(r.category_id);n.removeClass(t.unsaved)}c(n);setMessage(r.message,r.success)},"json")},c=function(n,r){n.removeClass(t.editing);if(n.hasClass(t.unsaved)){n.fadeOut(250,function(){e(this).remove()})}else{e(t.categoryDefaultPriceEditElements,n).hide();e(t.selectCategory,n).select2("destroy");e(t.categoryDefaultPriceInput,n).val(e(t.categoryDefaultPriceDisplay,n).text());var i=e(t.revenueModelLabelDisplay,n).text().toLowerCase();e(t.revenueModelLabel,n).removeClass(t.selected);e(".lp_js_revenue-model-input[value="+i+"]",n).prop("checked","checked").parent("label").addClass(t.selected);e(t.categoryDefaultPriceShowElements,n).show()}if(!r){t.addCategory.fadeIn(250)}},h=function(t){e("input[name=form]",t).val("price_category_form_delete");e.post(ajaxurl,t.serializeArray(),function(n){if(n.success){t.fadeOut(400,function(){e(this).remove()})}setMessage(n.message,n.success)},"json")},p=function(t,n){var r=e(n).parent().parent().parent();e(".lp_js_select-category",r).val(t.text);e(".lp_js_category-id",r).val(t.id);return t.text},d=function(n){e(t.selectCategory,n).select2({allowClear:true,ajax:{url:ajaxurl,data:function(e){return{term:e,action:"laterpay_pricing"}},results:function(t){var n=[];e.each(t,function(e){var r=t[e];n.push({id:r.term_id,text:r.name})});return{results:n}},dataType:"json"},initSelection:function(t,n){var r=e(t).val();if(r!==""){var i={text:r};n(i)}else{e.get(ajaxurl,{term:"",action:"laterpay_pricing"},function(e){console.log(e);if(e&&e[0]!==undefined){var t=e[0];n({text:t.name})}})}},formatResult:function(e){return e.text},formatSelection:p,escapeMarkup:function(e){return e}})},v=function(){e.post(ajaxurl,t.defaultCurrencyForm.serializeArray(),function(n){if(n.success){e(t.currency).html(n.laterpay_currency)}setMessage(n.message,n.success)},"json")},m=function(e,t){var n;return function(){var r=this,i=arguments;clearTimeout(n);n=setTimeout(function(){e.apply(r,i)},t)}},g=function(n){e.post(ajaxurl,n||t.bulkPriceForm.serializeArray(),function(e){setMessage(e.message,e.success)},"json")},y=function(n){t.bulkPriceObjects.append(e("<option>",{value:"in_category",text:lpVars.inCategoryLabel,selected:!!n}))},b=function(n,r){var i=r==="in_category";t.bulkPriceChangeUnit.find("option").each(function(){if(e(this).text()==="%"){e(this).remove()}}).end().addClass(t.disabled);t.bulkPriceObjects.find("option").each(function(){if(e(this).val()==="in_category"){e(this).remove()}});t.bulkPriceObjectsCategory.prop("disabled",true).hide();t.bulkPriceObjectsCategoryWithPrice.prop("disabled",true).hide();t.bulkPriceChangeAmountPreposition.hide();t.bulkPriceChangeAmount.prop("disabled",true).hide();t.bulkPriceChangeUnit.prop("disabled",true).hide();switch(n){case"set":t.bulkPriceChangeAmountPreposition.show().text(lpVars.i18n.to);t.bulkPriceChangeAmount.prop("disabled",false).show();t.bulkPriceChangeUnit.show();break;case"increase":case"reduce":t.bulkPriceChangeAmountPreposition.show().text(lpVars.i18n.by);t.bulkPriceChangeAmount.prop("disabled",false).show();t.bulkPriceChangeUnit.prop("disabled",false).show();t.bulkPriceChangeUnit.removeClass(t.disabled).append(e("<option>",{value:"percent",text:"%"}));break;case"free":if(t.bulkPriceObjectsCategory.length){y(i);if(i){t.bulkPriceObjectsCategory.prop("disabled",false).show()}}break;case"reset":t.bulkPriceChangeAmountPreposition.text(lpVars.i18n.toGlobalDefaultPrice+" "+lpVars.globalDefaultPrice+" "+lpVars.defaultCurrency);if(t.bulkPriceObjectsCategoryWithPrice.length){y(i);if(i){t.bulkPriceObjectsCategoryWithPrice.prop("disabled",false).show().change()}}t.bulkPriceChangeAmountPreposition.show();break;default:break}},w=function(e,n){var r='<p class="lp_bulk-operation" data-value="'+e+'">'+'<a href="#" class="lp_js_delete-saved-bulk-operation lp_edit-link lp_delete-link" data-icon="g">'+lpVars.i18n.delete+"</a>"+'<a href="#" class="lp_js_apply-saved-bulk-operation button button-primary lp_m-l2">'+lpVars.i18n.updatePrices+"</a>"+"<span>"+n+"</span>"+"</p>";t.bulkPriceForm.after(r)},E=function(){var n=e.trim(t.bulkPriceAction.find("option:selected").text())==="Make free"?"Make":t.bulkPriceAction.find("option:selected").text(),r=t.bulkPriceObjects.find("option:selected").text().toLowerCase(),i=e.trim(t.bulkPriceObjects.find("option:selected").text())==="All posts"?"":'"'+e.trim(t.bulkPriceObjectsCategory.find("option:selected").text())+'"',s=e.trim(t.bulkPriceAction.find("option:selected").text())==="Make free"?"":t.bulkPriceChangeAmountPreposition.text(),o=e.trim(t.bulkPriceAction.find("option:selected").text())==="Make free"?"":t.bulkPriceChangeAmount.val()+t.bulkPriceChangeUnit.find("option:selected").text(),u=e.trim(t.bulkPriceAction.find("option:selected").text())==="Make free"?"free":"",a=[n,r,i,s,o,u];a=e.trim(a.join(" ").replace(/\s+/g," "));e("input[name=form]",t.bulkPriceForm).val("bulk_price_form_save");e("input[name=bulk_operation_id]",t.bulkPriceForm).val(undefined);e("input[name=bulk_message]",t.bulkPriceForm).val(a);e.post(ajaxurl,t.bulkPriceForm.serializeArray(),function(e){if(e.success){w(e.data.id,e.data.message)}setMessage(e.message,e.success)},"json")},S=function(n){e("input[name=form]",t.bulkPriceForm).val("bulk_price_form");e("input[name=bulk_operation_id]",t.bulkPriceForm).val(n.data("value"));g()},x=function(n){e("input[name=form]",t.bulkPriceForm).val("bulk_price_form_delete");e("input[name=bulk_operation_id]",t.bulkPriceForm).val(n.data("value"));e.post(ajaxurl,t.bulkPriceForm.serializeArray(),function(e){if(e.success){n.fadeOut(250,function(){n.remove()})}setMessage(e.message,e.success)},"json")},T=function(){n();t.bulkPriceAction.change()};T()}t()})})(jQuery)
