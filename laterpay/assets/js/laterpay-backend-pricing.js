!function(e){e(function(){function t(){var t={revenueModel:".lp_js_revenue-model",revenueModelLabel:".lp_js_revenue-model-label",revenueModelLabelDisplay:".lp_js_revenue-model-label-display",revenueModelInput:".lp_js_revenue-model-input",priceInput:".lp_js_price-input",globalDefaultPriceForm:e("#lp_js_global-default-price-form"),globalDefaultPriceInput:e("#lp_js_global-default-price"),globalDefaultPriceDisplay:e("#lp_js_global-default-price-text"),globalDefaultPriceRevenueModelDisplay:e("#lp_js_global-default-price-revenue-model-label"),editGlobalDefaultPrice:e("#lp_js_edit-global-default-price"),cancelEditingGlobalDefaultPrice:e("#lp_js_cancel-editing-global-default-price"),saveGlobalDefaultPrice:e("#lp_js_save-global-default-price"),globalDefaultPriceShowElements:e("#lp_js_global-default-price-text, #lp_js_edit-global-default-price, #lp_js_global-default-price-revenue-model-label"),globalDefaultPriceEditElements:e("#lp_js_global-default-price, #lp_js_global-default-price-revenue-model, #lp_js_cancel-editing-global-default-price, #lp_js_save-global-default-price"),categoryDefaultPrices:e("#lp_js_category-default-prices-list"),addCategory:e("#lp_js_add-category-default-price"),categoryDefaultPriceTemplate:e("#lp_js_category-default-price-template"),categoryDefaultPriceForm:".lp_js_category-default-price-form",editCategoryDefaultPrice:".lp_js_edit-category-default-price",cancelEditingCategoryDefaultPrice:".lp_js_cancel-editing-category-default-price",saveCategoryDefaultPrice:".lp_js_save-category-default-price",deleteCategoryDefaultPrice:".lp_js_delete-category-default-price",categoryDefaultPriceShowElements:".lp_js_category-title, .lp_js_revenue-model-label-display, .lp_js_category-default-price-display, .lp_js_edit-category-default-price, .lp_js_delete-category-default-price",categoryDefaultPriceEditElements:".lp_js_category-default-price-input, .lp_js_revenue-model, .lp_js_save-category-default-price, .lp_js_cancel-editing-category-default-price",categoryTitle:".lp_js_category-title",categoryDefaultPriceDisplay:".lp_js_category-default-price-display",selectCategory:".lp_js_select-category",categoryDefaultPriceInput:".lp_js_category-default-price-input",categoryId:".lp_js_category-id",bulkPriceForm:e("#lp_js_bulk-price-form"),bulkPriceAction:e("#lp_js_change-bulk-action"),bulkPriceObjects:e("#lp_js_select-bulk-objects"),bulkPriceObjectsCategory:e("#lp_js_select-bulk-objects-category"),bulkPriceObjectsCategoryWithPrice:e("#lp_js_select-bulk-objects-category-with-price"),bulkPriceChangeAmountModifier:e("#lp_js_bulk-amount-modifier"),bulkPriceChangeAmount:e("#lp_js_set-bulk-change-amount"),bulkPriceChangeUnit:e("#lp_js_set-bulk-change-unit"),bulkPriceSubmit:e("#lp_js_apply-bulk-operation"),defaultCurrencyForm:e("#lp_js_default-currency-form"),defaultCurrency:e("#lp_js_change-default-currency"),currency:".lp_js_currency",editing:"lp_is_editing",unsaved:"lp_is_unsaved",payPerUse:"ppu",singleSale:"sis",selected:"lp_is-selected",disabled:"lp_is-disabled"},l=function(){e("body").on("change",t.revenueModelInput,function(){a(e(this).parents("form"))}),e("body").on("keyup",t.priceInput,_(function(){a(e(this).parents("form"))},800)),t.editGlobalDefaultPrice.mousedown(function(){i()}).click(function(e){e.preventDefault()}),t.cancelEditingGlobalDefaultPrice.mousedown(function(){c()}).click(function(e){e.preventDefault()}),t.saveGlobalDefaultPrice.mousedown(function(){o()}).click(function(e){e.preventDefault()}),t.addCategory.mousedown(function(){n()}).click(function(e){e.preventDefault()}),t.categoryDefaultPrices.on("click",t.editCategoryDefaultPrice,function(){var l=e(this).parents(t.categoryDefaultPriceForm);s(l)}),t.categoryDefaultPrices.on("click",t.cancelEditingCategoryDefaultPrice,function(){var l=e(this).parents(t.categoryDefaultPriceForm);d(l)}),t.categoryDefaultPrices.on("click",t.saveCategoryDefaultPrice,function(){var l=e(this).parents(t.categoryDefaultPriceForm);u(l)}),t.categoryDefaultPrices.on("click",t.deleteCategoryDefaultPrice,function(){var l=e(this).parents(t.categoryDefaultPriceForm);p(l)}),t.bulkPriceAction.add(t.bulkPriceObjects).on("change",function(){h(t.bulkPriceAction.val(),t.bulkPriceObjects.val())}),t.bulkPriceObjectsCategoryWithPrice.on("change",function(){t.bulkPriceChangeAmountModifier.show().text(lpVars.i18nModifier.toCategoryDefaultPrice+" "+t.bulkPriceObjectsCategoryWithPrice.find(":selected").attr("data-price")+" "+lpVars.defaultCurrency)}),t.bulkPriceForm.on("submit",function(e){y(),e.preventDefault()}),t.defaultCurrency.change(function(){b()})},a=function(t){var l,a=e(".lp_number-input",t),i=a.val();return i=i.replace(/[^0-9\,\.]/g,""),i=i.indexOf(",")>-1?parseFloat(i.replace(",",".")).toFixed(2):parseFloat(i).toFixed(2),isNaN(i)&&(i=0,l=!0),i=Math.abs(i),i>149.99?(i=149.99,l=!0):i>0&&.05>i&&(i=.05,l=!0),r(i,t),i=i.toFixed(2),"de_DE"===lpVars.locale&&(i=i.replace(".",",")),a.val(i),i},r=function(l,a){var r=e("input:radio:checked",a).val(),i=e(".lp_js_revenue-model-input[value="+t.payPerUse+"]",a),c=e(".lp_js_revenue-model-input[value="+t.singleSale+"]",a);0===l||l>=.05&&5>=l?i.removeProp("disabled").parent("label").removeClass(t.disabled):i.prop("disabled","disabled").parent("label").addClass(t.disabled),l>=1.49?c.removeProp("disabled").parent("label").removeClass(t.disabled):c.prop("disabled","disabled").parent("label").addClass(t.disabled),l>5&&r===t.payPerUse?c.prop("checked","checked"):1.49>l&&r===t.singleSale&&i.prop("checked","checked"),e("label",a).removeClass(t.selected),e(".lp_js_revenue-model-input:checked",a).parent("label").addClass(t.selected)},i=function(){t.globalDefaultPriceShowElements.hide(),t.globalDefaultPriceEditElements.show(0,function(){setTimeout(function(){t.globalDefaultPriceInput.val(t.globalDefaultPriceDisplay.text()).focus()},50)}),t.globalDefaultPriceForm.addClass(t.editing)},c=function(){t.globalDefaultPriceShowElements.show(),t.globalDefaultPriceEditElements.hide(),t.globalDefaultPriceForm.removeClass(t.editing),t.globalDefaultPriceInput.val(t.globalDefaultPriceDisplay.text());var l=t.globalDefaultPriceRevenueModelDisplay.text().toLowerCase();e(t.revenueModelLabel,t.globalDefaultPriceForm).removeClass(t.selected),e(".lp_js_revenue-model-input[value="+l+"]",t.globalDefaultPriceForm).prop("checked","checked").parent("label").addClass(t.selected)},o=function(){var l=a(t.globalDefaultPriceForm);t.globalDefaultPriceInput.val(l),e.post(ajaxurl,t.globalDefaultPriceForm.serializeArray(),function(e){e.success&&(t.globalDefaultPriceDisplay.html(e.laterpay_global_price),t.globalDefaultPriceRevenueModelDisplay.text(e.laterpay_price_revenue_model)),setMessage(e.message,e.success),c()},"json")},n=function(){t.addCategory.fadeOut(250);var e=t.categoryDefaultPriceTemplate.clone().removeAttr("id").appendTo("#lp_js_category-default-prices-list").fadeIn(250);s(e)},s=function(l){e(".lp_js_category-default-price-form.lp_is_editing").each(function(){d(e(this),!0)}),l.addClass(t.editing),e(t.categoryDefaultPriceShowElements,l).hide(),t.addCategory.fadeOut(250),e(t.categoryDefaultPriceEditElements,l).show(),g(l)},u=function(l){var r=a(l);e(t.categoryDefaultPriceInput,l).val(r),e.post(ajaxurl,l.serializeArray(),function(a){a.success&&(e(t.categoryDefaultPriceDisplay,l).text(a.price),e(t.revenueModelLabelDisplay,l).text(a.revenue_model),e(t.categoryDefaultPriceInput,l).val(a.price),e(t.categoryTitle,l).text(a.category),e(t.categoryId,l).val(a.category_id),l.removeClass(t.unsaved)),d(l),setMessage(a.message,a.success)},"json")},d=function(l,a){if(l.removeClass(t.editing),l.hasClass(t.unsaved))l.fadeOut(250,function(){e(this).remove()});else{e(t.categoryDefaultPriceEditElements,l).hide(),e(t.selectCategory,l).select2("destroy"),e(t.categoryDefaultPriceInput,l).val(e(t.categoryDefaultPriceDisplay,l).text());var r=e(t.revenueModelLabelDisplay,l).text().toLowerCase();e(t.revenueModelLabel,l).removeClass(t.selected),e(".lp_js_revenue-model-input[value="+r+"]",l).prop("checked","checked").parent("label").addClass(t.selected),e(t.categoryDefaultPriceShowElements,l).show()}a||t.addCategory.fadeIn(250)},p=function(t){e("input[name=form]",t).val("price_category_form_delete"),e.post(ajaxurl,t.serializeArray(),function(l){l.success&&t.fadeOut(400,function(){e(this).remove()}),setMessage(l.message,l.success)},"json")},f=function(t,l){var a=e(l).parent().parent().parent();return e(".lp_js_select-category",a).val(t.text),e(".lp_js_category-id",a).val(t.id),t.text},g=function(l){e(t.selectCategory,l).select2({allowClear:!0,ajax:{url:ajaxurl,data:function(e){return{term:e,action:"laterpay_pricing"}},results:function(t){var l=[];return e.each(t,function(e){var a=t[e];l.push({id:a.term_id,text:a.name})}),{results:l}},dataType:"json"},initSelection:function(t,l){var a=e(t).val();if(""!==a){var r={text:a};l(r)}else e.get(ajaxurl,{term:"",action:"laterpay_pricing"},function(e){if(e&&void 0!==e[0]){var t=e[0];l({text:t.name})}})},formatResult:function(e){return e.text},formatSelection:f,escapeMarkup:function(e){return e}})},b=function(){e.post(ajaxurl,t.defaultCurrencyForm.serializeArray(),function(l){l.success&&e(t.currency).html(l.laterpay_currency),setMessage(l.message,l.success)},"json")},_=function(e,t){var l;return function(){var a=this,r=arguments;clearTimeout(l),l=setTimeout(function(){e.apply(a,r)},t)}},y=function(){e.post(ajaxurl,t.bulkPriceForm.serializeArray(),function(e){setMessage(e.message,e.success)},"json")},P=function(){t.bulkPriceObjectsCategory.length||t.bulkPriceObjects.find("option").each(function(){("not_in_category"===e(this).val()||"in_category"===e(this).val())&&e(this).prop("disabled",!0)})},h=function(l,a){var r="in_category"===a||"not_in_category"===a;switch(t.bulkPriceChangeUnit.find("option").each(function(){"%"===e(this).text()&&e(this).remove()}).end().addClass(t.disabled),t.bulkPriceObjects.find("option").each(function(){e(this).prop("disabled",!1)}),t.bulkPriceObjectsCategoryWithPrice.hide(),t.bulkPriceChangeAmountModifier.hide(),t.bulkPriceChangeAmount.hide(),t.bulkPriceChangeUnit.hide(),l){case"set":t.bulkPriceChangeAmountModifier.show().text(lpVars.i18nModifier.to),t.bulkPriceChangeAmount.show(),t.bulkPriceChangeUnit.show(),P(),r?t.bulkPriceObjectsCategory.show():t.bulkPriceObjectsCategory.hide();break;case"increase":case"reduce":t.bulkPriceChangeAmountModifier.show().text(lpVars.i18nModifier.by),t.bulkPriceChangeAmount.show(),t.bulkPriceChangeUnit.show(),t.bulkPriceChangeUnit.removeClass(t.disabled).append(e("<option>",{value:"percent",text:"%"})),P(),r?t.bulkPriceObjectsCategory.show():t.bulkPriceObjectsCategory.hide();break;case"free":t.bulkPriceObjectsCategory.length||t.bulkPriceObjects.find("option").each(function(){("not_in_category"===e(this).val()||"in_category"===e(this).val())&&e(this).prop("disabled",!0)}),P(),r?t.bulkPriceObjectsCategory.show():t.bulkPriceObjectsCategory.hide();break;case"reset":t.bulkPriceObjectsCategory.hide(),t.bulkPriceObjects.find("option").each(function(){("not_in_category"===e(this).val()||"in_category"===e(this).val()&&!t.bulkPriceObjectsCategoryWithPrice.length)&&e(this).prop("disabled",!0)}),r?t.bulkPriceObjectsCategoryWithPrice.show().change():t.bulkPriceChangeAmountModifier.show().text(lpVars.i18nModifier.toGlobalDefaultPrice+" "+lpVars.globalDefaultPrice+" "+lpVars.defaultCurrency)}},m=function(){l(),t.bulkPriceAction.change()};m()}t()})}(jQuery);