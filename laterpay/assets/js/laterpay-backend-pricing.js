!function(e){e(function(){function l(){var l={revenueModel:".lp_js_revenue-model",revenueModelLabel:".lp_js_revenue-model-label",revenueModelLabelDisplay:".lp_js_revenue-model-label-display",revenueModelInput:".lp_js_revenue-model-input",priceInput:".lp_js_price-input",globalDefaultPriceForm:e("#lp_js_global-default-price-form"),globalDefaultPriceInput:e("#lp_js_global-default-price"),globalDefaultPriceDisplay:e("#lp_js_global-default-price-text"),globalDefaultPriceRevenueModelDisplay:e("#lp_js_global-default-price-revenue-model-label"),editGlobalDefaultPrice:e("#lp_js_edit-global-default-price"),cancelEditingGlobalDefaultPrice:e("#lp_js_cancel-editing-global-default-price"),saveGlobalDefaultPrice:e("#lp_js_save-global-default-price"),globalDefaultPriceShowElements:e("#lp_js_global-default-price-text, #lp_js_edit-global-default-price, #lp_js_global-default-price-revenue-model-label"),globalDefaultPriceEditElements:e("#lp_js_global-default-price, #lp_js_global-default-price-revenue-model, #lp_js_cancel-editing-global-default-price, #lp_js_save-global-default-price"),categoryDefaultPrices:e("#lp_js_category-default-prices-list"),addCategory:e("#lp_js_add-category-default-price"),categoryDefaultPriceTemplate:e("#lp_js_category-default-price-template"),categoryDefaultPriceForm:".lp_js_category-default-price-form",editCategoryDefaultPrice:".lp_js_edit-category-default-price",cancelEditingCategoryDefaultPrice:".lp_js_cancel-editing-category-default-price",saveCategoryDefaultPrice:".lp_js_save-category-default-price",deleteCategoryDefaultPrice:".lp_js_delete-category-default-price",categoryDefaultPriceShowElements:".lp_js_category-title, .lp_js_revenue-model-label-display, .lp_js_category-default-price-display, .lp_js_edit-category-default-price, .lp_js_delete-category-default-price",categoryDefaultPriceEditElements:".lp_js_category-default-price-input, .lp_js_revenue-model, .lp_js_save-category-default-price, .lp_js_cancel-editing-category-default-price",categoryTitle:".lp_js_category-title",categoryDefaultPriceDisplay:".lp_js_category-default-price-display",selectCategory:".lp_js_select-category",categoryDefaultPriceInput:".lp_js_category-default-price-input",categoryId:".lp_js_category-id",bulkPriceForm:e("#lp_js_bulk-price-form"),bulkPriceAction:e("#lp_js_change-bulk-action"),bulkPriceObjects:e("#lp_js_select-bulk-objects"),bulkPriceObjectsCategory:e("#lp_js_select-bulk-objects-category"),bulkPriceChangeAmountModifier:e("#lp_js_bulk-amount-modifier"),bulkPriceChangeAmount:e("#lp_js_set-bulk-change-amount"),bulkPriceChangeUnit:e("#lp_js_set-bulk-change-unit"),bulkPriceSubmit:e("#lp_js_apply-bulk-operation"),defaultCurrencyForm:e("#lp_js_default-currency-form"),defaultCurrency:e("#lp_js_change-default-currency"),currency:".lp_js_currency",editing:"lp_is_editing",unsaved:"lp_is_unsaved",payPerUse:"ppu",singleSale:"sis",selected:"lp_is-selected",disabled:"lp_is-disabled"},a=function(){e("body").on("change",l.revenueModelInput,function(){t(e(this).parents("form"))}),e("body").on("keyup",l.priceInput,b(function(){t(e(this).parents("form"))},800)),l.editGlobalDefaultPrice.mousedown(function(){c()}).click(function(e){e.preventDefault()}),l.cancelEditingGlobalDefaultPrice.mousedown(function(){i()}).click(function(e){e.preventDefault()}),l.saveGlobalDefaultPrice.mousedown(function(){o()}).click(function(e){e.preventDefault()}),l.addCategory.mousedown(function(){n()}).click(function(e){e.preventDefault()}),l.categoryDefaultPrices.on("click",l.editCategoryDefaultPrice,function(){var a=e(this).parents(l.categoryDefaultPriceForm);s(a)}),l.categoryDefaultPrices.on("click",l.cancelEditingCategoryDefaultPrice,function(){var a=e(this).parents(l.categoryDefaultPriceForm);d(a)}),l.categoryDefaultPrices.on("click",l.saveCategoryDefaultPrice,function(){var a=e(this).parents(l.categoryDefaultPriceForm);u(a)}),l.categoryDefaultPrices.on("click",l.deleteCategoryDefaultPrice,function(){var a=e(this).parents(l.categoryDefaultPriceForm);p(a)}),l.bulkPriceAction.add(l.bulkPriceObjects).on("change",function(){m(l.bulkPriceAction.val(),l.bulkPriceObjects.val())}),l.bulkPriceForm.on("submit",function(e){y(),e.preventDefault()}),l.defaultCurrency.change(function(){_()})},t=function(l){var a,t=e(".lp_number-input",l),c=t.val();return c=c.replace(/[^0-9\,\.]/g,""),c=c.indexOf(",")>-1?parseFloat(c.replace(",",".")).toFixed(2):parseFloat(c).toFixed(2),isNaN(c)&&(c=0,a=!0),c=Math.abs(c),c>149.99?(c=149.99,a=!0):c>0&&.05>c&&(c=.05,a=!0),r(c,l),c=c.toFixed(2),"de_DE"===lpVars.locale&&(c=c.replace(".",",")),t.val(c),c},r=function(a,t){var r=e("input:radio:checked",t).val(),c=e(".lp_js_revenue-model-input[value="+l.payPerUse+"]",t),i=e(".lp_js_revenue-model-input[value="+l.singleSale+"]",t);0===a||a>=.05&&5>=a?c.removeProp("disabled").parent("label").removeClass(l.disabled):c.prop("disabled","disabled").parent("label").addClass(l.disabled),a>=1.49?i.removeProp("disabled").parent("label").removeClass(l.disabled):i.prop("disabled","disabled").parent("label").addClass(l.disabled),a>5&&r===l.payPerUse?i.prop("checked","checked"):1.49>a&&r===l.singleSale&&c.prop("checked","checked"),e("label",t).removeClass(l.selected),e(".lp_js_revenue-model-input:checked",t).parent("label").addClass(l.selected)},c=function(){l.globalDefaultPriceShowElements.hide(),l.globalDefaultPriceEditElements.show(0,function(){setTimeout(function(){l.globalDefaultPriceInput.val(l.globalDefaultPriceDisplay.text()).focus()},50)}),l.globalDefaultPriceForm.addClass(l.editing)},i=function(){l.globalDefaultPriceShowElements.show(),l.globalDefaultPriceEditElements.hide(),l.globalDefaultPriceForm.removeClass(l.editing),l.globalDefaultPriceInput.val(l.globalDefaultPriceDisplay.text());var a=l.globalDefaultPriceRevenueModelDisplay.text().toLowerCase();e(l.revenueModelLabel,l.globalDefaultPriceForm).removeClass(l.selected),e(".lp_js_revenue-model-input[value="+a+"]",l.globalDefaultPriceForm).prop("checked","checked").parent("label").addClass(l.selected)},o=function(){var a=t(l.globalDefaultPriceForm);l.globalDefaultPriceInput.val(a),e.post(ajaxurl,l.globalDefaultPriceForm.serializeArray(),function(e){e.success&&(l.globalDefaultPriceDisplay.html(e.laterpay_global_price),l.globalDefaultPriceRevenueModelDisplay.text(e.laterpay_price_revenue_model)),setMessage(e.message,e.success),i()},"json")},n=function(){l.addCategory.fadeOut(250);var e=l.categoryDefaultPriceTemplate.clone().removeAttr("id").appendTo("#lp_js_category-default-prices-list").fadeIn(250);s(e)},s=function(a){e(".lp_js_category-default-price-form.lp_is_editing").each(function(){d(e(this),!0)}),a.addClass(l.editing),e(l.categoryDefaultPriceShowElements,a).hide(),l.addCategory.fadeOut(250),e(l.categoryDefaultPriceEditElements,a).show(),g(a)},u=function(a){var r=t(a);e(l.categoryDefaultPriceInput,a).val(r),e.post(ajaxurl,a.serializeArray(),function(t){t.success&&(e(l.categoryDefaultPriceDisplay,a).text(t.price),e(l.revenueModelLabelDisplay,a).text(t.revenue_model),e(l.categoryDefaultPriceInput,a).val(t.price),e(l.categoryTitle,a).text(t.category),e(l.categoryId,a).val(t.category_id),a.removeClass(l.unsaved)),d(a),setMessage(t.message,t.success)},"json")},d=function(a,t){if(a.removeClass(l.editing),a.hasClass(l.unsaved))a.fadeOut(250,function(){e(this).remove()});else{e(l.categoryDefaultPriceEditElements,a).hide(),e(l.selectCategory,a).select2("destroy"),e(l.categoryDefaultPriceInput,a).val(e(l.categoryDefaultPriceDisplay,a).text());var r=e(l.revenueModelLabelDisplay,a).text().toLowerCase();e(l.revenueModelLabel,a).removeClass(l.selected),e(".lp_js_revenue-model-input[value="+r+"]",a).prop("checked","checked").parent("label").addClass(l.selected),e(l.categoryDefaultPriceShowElements,a).show()}t||l.addCategory.fadeIn(250)},p=function(l){e("input[name=form]",l).val("price_category_form_delete"),e.post(ajaxurl,l.serializeArray(),function(a){a.success&&l.fadeOut(400,function(){e(this).remove()}),setMessage(a.message,a.success)},"json")},f=function(l,a){var t=e(a).parent().parent().parent();return e(".lp_js_select-category",t).val(l.text),e(".lp_js_category-id",t).val(l.id),l.text},g=function(a){e(l.selectCategory,a).select2({allowClear:!0,ajax:{url:ajaxurl,data:function(e){return{term:e,action:"laterpay_pricing"}},results:function(l){var a=[];return e.each(l,function(e){var t=l[e];a.push({id:t.term_id,text:t.name})}),{results:a}},dataType:"json"},initSelection:function(l,a){var t=e(l).val();if(""!==t){var r={text:t};a(r)}else e.get(ajaxurl,{term:"",action:"laterpay_pricing"},function(e){if(e&&void 0!==e[0]){var l=e[0];a({text:l.name})}})},formatResult:function(e){return e.text},formatSelection:f,escapeMarkup:function(e){return e}})},_=function(){e.post(ajaxurl,l.defaultCurrencyForm.serializeArray(),function(a){a.success&&e(l.currency).html(a.laterpay_currency),setMessage(a.message,a.success)},"json")},b=function(e,l){var a;return function(){var t=this,r=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(t,r)},l)}},y=function(){e.post(ajaxurl,l.bulkPriceForm.serializeArray(),function(e){setMessage(e.message,e.success)},"json")},m=function(a,t){var r="in_category"===t||"not_in_category"===t;switch(l.bulkPriceChangeUnit.find("option").each(function(){"%"===e(this).text()&&e(this).remove()}).end().addClass(l.disabled),a){case"set":l.bulkPriceChangeAmountModifier.text(lpVars.i18nModifierTo).show(),l.bulkPriceChangeAmount.show(),l.bulkPriceChangeUnit.show(),r?l.bulkPriceObjectsCategory.show():l.bulkPriceObjectsCategory.hide();break;case"increase":case"reduce":l.bulkPriceChangeAmountModifier.text(lpVars.i18nModifierBy).show(),l.bulkPriceChangeAmount.show(),l.bulkPriceChangeUnit.show(),l.bulkPriceChangeUnit.removeClass(l.disabled).append(e("<option>",{value:"percent",text:"%"})),r?l.bulkPriceObjectsCategory.show():l.bulkPriceObjectsCategory.hide();break;case"free":l.bulkPriceChangeAmountModifier.hide(),l.bulkPriceChangeAmount.hide(),l.bulkPriceChangeUnit.hide(),r?l.bulkPriceObjectsCategory.show():l.bulkPriceObjectsCategory.hide()}},v=function(){a(),l.bulkPriceAction.change()};v()}l()})}(jQuery);