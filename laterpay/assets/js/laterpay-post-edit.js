!function(e){e(function(){function i(){var i={priceInput:e("#lp_js_post-price-input"),priceTypeInput:e("#lp_js_post-price-type-input"),revenueModel:e("#lp_js_post-revenue-model"),categoryInput:e("#lp_js_post-default-category-input"),priceSection:e("#lp_js_price-type"),pricingTypeButtonGroup:e("#lp_js_price-type-button-group"),pricingTypeButtons:e(".lp_js_price-type-button"),individualPriceButton:e("#lp_js_use-individual-price").parent(),categoryPriceButton:e("#lp_js_use-category-default-price").parent(),globalPriceButton:e("#lp_js_use-global-default-price").parent(),details:e("#lp_js_price-type-details"),detailsSections:e(".lp_js_details-section"),individualPriceDetails:e("#lp_js_individual-price-details"),categoryPriceDetails:e("#lp_js_category-price-details"),categoriesList:e("#lp_js_category-price-details ul"),categories:e("#lp_js_category-price-details li"),dynamicPricingToggle:e("#lp_js_toggle-dynamic-pricing"),dynamicPricingContainer:"#lp_js_dynamic-pricing-widget-container",expanded:"lp_is-expanded",selected:"lp_is-selected",disabled:"lp_is-disabled",dynamicPricingApplied:"lp_is-with-dynamic-pricing",selectedCategory:"lp_selected-category",payPerUse:"ppu",singleSale:"sis"},a=function(){i.pricingTypeButtons.mousedown(function(){t(this)}).click(function(e){e.preventDefault()}),e("#post").submit(function(){_()}),i.priceInput.keyup(m(function(){l(e(this).val())},800)),e("input:radio",i.revenueModel).change(function(){s(i.priceInput.val())}),i.dynamicPricingToggle.mousedown(function(){o()}).click(function(e){e.preventDefault()}),e(".categorychecklist input:checkbox").on("change",function(){p()}),i.categoryPriceDetails.on("mousedown","a",function(){d(this)}).on("click","a",function(e){e.preventDefault()})},t=function(a){var t,n,p=e(a),d=p.parent("li"),o=p.attr("id");if(!d.hasClass(i.disabled)&&!d.hasClass(i.selected)){if(e("."+i.selected,i.pricingTypeButtonGroup).removeClass(i.selected),d.addClass(i.selected),i.priceSection.removeClass(i.expanded),i.detailsSections.hide(),"lp_js_use-individual-price"===o)i.priceSection.addClass(i.expanded),i.dynamicPricingToggle.show(),i.priceTypeInput.val("individual price"),s(i.priceInput.val()),i.dynamicPricingToggle.text()===lpVars.i18nRemoveDynamicPricing&&(y(),i.individualPriceDetails.show());else if("lp_js_use-category-default-price"===o){c();var u=e(".lp_selected-category a",i.categoriesList);t=u.attr("data-price"),n=u.attr("data-revenue-model"),l(t),r(n,!0),i.priceSection.addClass(i.expanded),i.categoryPriceDetails.show(),i.categories.slideDown(250),i.dynamicPricingToggle.hide(),i.priceTypeInput.val("category default price")}else"lp_js_use-global-default-price"===o&&(t=p.attr("data-price"),n=p.attr("data-revenue-model"),l(t),r(n,!0),i.dynamicPricingToggle.hide(),i.priceTypeInput.val("global default price"));"lp_js_use-individual-price"!==o||i.dynamicPricingToggle.hasClass(i.dynamicPricingApplied)?(i.dynamicPricingToggle.hasClass(i.dynamicPricingApplied)&&g(),i.priceInput.attr("disabled","disabled")):(i.priceInput.removeAttr("disabled"),setTimeout(function(){i.priceInput.focus()},50))}},l=function(e){var a=s(e);i.priceInput.val(a)},r=function(a,t){e("label",i.revenueModel).removeClass(i.selected),t&&e("input:radio[value!="+a+"]",i.revenueModel).parent("label").addClass(i.disabled),e("input:radio[value="+a+"]",i.revenueModel).prop("checked","checked").parent("label").removeClass(i.disabled).addClass(i.selected)},s=function(e){return e=e.toString().replace(/[^0-9\,\.]/g,""),e="string"==typeof e&&e.indexOf(",")>-1?parseFloat(e.replace(",",".")).toFixed(2):parseFloat(e).toFixed(2),isNaN(e)&&(e=0),e=Math.abs(e),e>lpVars.limits.sis_max?e=lpVars.limits.sis_max:e>0&&e<lpVars.limits.ppu_min&&(e=lpVars.limits.ppu_min),n(e),e=e.toFixed(2),"de_DE"===lpVars.locale&&(e=e.replace(".",",")),e},n=function(a){var t=e("input:radio:checked",i.revenueModel).val(),l=e("input:radio[value="+i.payPerUse+"]",i.revenueModel),r=e("input:radio[value="+i.singleSale+"]",i.revenueModel);0===a||a>=lpVars.limits.ppu_min&&a<lpVars.limits.price_sis_end?l.removeAttr("disabled").parent("label").removeClass(i.disabled):l.attr("disabled","disabled").parent("label").addClass(i.disabled),a>=lpVars.limits.sis_min?r.removeAttr("disabled").parent("label").removeClass(i.disabled):r.attr("disabled","disabled").parent("label").addClass(i.disabled),a>=lpVars.limits.ppusis_max&&t===i.payPerUse?r.prop("checked",!0):a<lpVars.limits.sis_min&&t===i.singleSale&&l.prop("checked",!0),e("label",i.revenueModel).removeClass(i.selected),e("input:radio:checked",i.revenueModel).parent("label").addClass(i.selected)},c=function(){var a=i.categoryInput.val(),t=i.categories.first();if(!i.categories.length)return void i.categoryInput.val("");if("undefined"!=typeof a&&e("[data-category="+a+"]",i.categories.parent()).length?e("[data-category="+a+"]",i.categories.parent()).addClass(i.selectedCategory):(t.addClass(i.selectedCategory),i.categoryInput.val(t.data("category"))),i.categoryPriceButton.hasClass(i.selected)){var s=e(".lp_selected-category a",i.categoriesList),n=s.attr("data-price"),c=s.attr("data-revenue-model");l(n),r(c,!0)}},p=function(){var a,t,s=e("#categorychecklist :checkbox:checked"),n=s.length,p=[],d="";for(a=0;n>a;a++)t=parseInt(s.eq(a).val(),10),p.push(t);e.post(lpVars.ajaxUrl,{action:"laterpay_get_category_prices",form:"laterpay_get_category_prices",category_ids:p},function(a){a&&(a.forEach(function(e){d+='<li data-category="'+e.category_id+'"><a href="#" data-price="'+e.category_price+'" data-revenue-model="'+e.revenue_model+'"><span>'+parseFloat(e.category_price).toFixed(2)+" "+lpVars.currency+"</span>"+e.category_name+"</a></li>"}),i.categoriesList.html(d),a.length?(i.categoryPriceButton.removeClass(i.disabled),i.categories=e("#lp_js_category-price-details li"),c()):(i.categoryPriceButton.addClass(i.disabled),i.detailsSections.hide(),i.categoryPriceButton.hasClass(i.selected)&&(e("."+i.selected,i.pricingTypeButtonGroup).removeClass(i.selected),i.priceSection.removeClass(i.expanded),i.globalPriceButton.hasClass(i.disabled)?(i.individualPriceButton.addClass(i.selected),i.priceTypeInput.val("individual price"),i.dynamicPricingToggle.show(),i.priceInput.removeAttr("disabled"),l(0),r(i.payPerUse,!1)):(i.globalPriceButton.addClass(i.selected),i.priceTypeInput.val("global default price"),l(lpVars.globalDefaultPrice),r(e("a",i.globalPriceButton).attr("data-revenue-model"),!0)))))},"json")},d=function(a){var t=e(a),s=t.parent(),n=s.attr("data-category"),c=t.attr("data-price"),p=t.attr("data-revenue-model");i.categories.removeClass(i.selectedCategory),s.addClass(i.selectedCategory),i.categoryInput.val(n),l(c),r(p,!0)},o=function(){i.dynamicPricingToggle.hasClass(i.dynamicPricingApplied)?(g(),i.revenueModel.show()):u()},u=function(){y(),i.dynamicPricingToggle.addClass(i.dynamicPricingApplied),i.priceInput.attr("disabled","disabled"),i.individualPriceDetails.slideDown(250),i.priceTypeInput.val("individual price, dynamic"),i.dynamicPricingToggle.text(lpVars.i18nRemoveDynamicPricing),i.revenueModel.hide()},g=function(){i.dynamicPricingToggle.removeClass(i.dynamicPricingApplied),i.priceInput.removeAttr("disabled"),i.individualPriceDetails.slideUp(250,function(){e(i.dynamicPricingContainer).empty()}),i.priceTypeInput.val("individual price"),i.dynamicPricingToggle.text(lpVars.i18nAddDynamicPricing)},y=function(){var e=lpVars.dynamicPricingData,a=new LPCurve(i.dynamicPricingContainer),t=lpVars.dynamicPricingData[0].y,l=lpVars.dynamicPricingData[3].y,r=0,s=5;window.lpc=a,i.priceInput.attr("disabled","disabled"),t>lpVars.limits.ppusis_max||l>lpVars.limits.ppusis_max?(s=lpVars.limits.sis_max,r=lpVars.limits.sis_min):t>=lpVars.limits.sis_min||l>=lpVars.limits.sis_min?(s=lpVars.limits.ppusis_max,r=lpVars.limits.ppusis_min):(s=lpVars.limits.ppu_max,r=lpVars.limits.ppu_min),lpVars.limits.pubDays>0&&a.set_today(lpVars.limits.pubDays,lpVars.limits.todayPrice),4===e.length?a.set_data(e).setPrice(r,s,lpVars.globalDefaultPrice).plot():a.set_data(e).setPrice(r,s,lpVars.globalDefaultPrice).interpolate("step-before").plot()},_=function(){if(i.dynamicPricingToggle.hasClass(i.dynamicPricingApplied)){var a=window.lpc.get_data();return 4===window.lpc.get_data().length?(e("input[name=laterpay_start_price]").val(a[0].y),e("input[name=laterpay_end_price]").val(a[3].y),e("input[name=laterpay_change_start_price_after_days]").val(a[1].x),e("input[name=laterpay_transitional_period_end_after_days]").val(a[2].x),e("input[name=laterpay_reach_end_price_after_days]").val(a[3].x)):3===window.lpc.get_data().length&&(e("input[name=laterpay_start_price]").val(a[0].y),e("input[name=laterpay_end_price]").val(a[2].y),e("input[name=laterpay_change_start_price_after_days]").val(a[1].x),e("input[name=laterpay_transitional_period_end_after_days]").val(0),e("input[name=laterpay_reach_end_price_after_days]").val(a[2].x)),!0}},m=function(e,i){var a=void 0;return function(){var t=this,l=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(t,l)},i)}},v=function(){a(),i.dynamicPricingToggle.hasClass(i.dynamicPricingApplied)&&y()};v()}i()})}(jQuery);