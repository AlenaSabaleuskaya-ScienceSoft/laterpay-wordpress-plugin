!function(e){e(function(){function a(){var a={priceInput:e("#lp_js_post-price-input"),priceTypeInput:e("#lp_js_post-price-type-input"),revenueModel:e("#lp_js_post-revenue-model"),categoryInput:e("#lp_js_post-default-category-input"),priceSection:e("#lp_js_price-type"),pricingTypeButtonGroup:e("#lp_js_price-type-button-group"),pricingTypeButtons:e(".lp_js_price-type-button"),individualPriceButton:e("#lp_js_use-individual-price").parent(),categoryPriceButton:e("#lp_js_use-category-default-price").parent(),globalPriceButton:e("#lp_js_use-global-default-price").parent(),details:e("#lp_js_price-type-details"),detailsSections:e(".lp_js_details-section"),individualPriceDetails:e("#lp_js_individual-price-details"),categoryPriceDetails:e("#lp_js_category-price-details"),categoriesList:e("#lp_js_category-price-details ul"),categories:e("#lp_js_category-price-details li"),dynamicPricingToggle:e("#lp_js_toggle-dynamic-pricing"),dynamicPricingContainer:"#lp_js_dynamic-pricing-widget-container",expanded:"lp_is-expanded",selected:"lp_is-selected",disabled:"lp_is-disabled",dynamicPricingApplied:"lp_is-with-dynamic-pricing",selectedCategory:"lp_selected-category",payPerUse:"ppu",singleSale:"sis"},i=function(){a.pricingTypeButtons.mousedown(function(){t(this)}).click(function(e){e.preventDefault()}),e("#post").submit(function(){_()}),a.priceInput.keyup(v(function(){r(e(this).val())},800)),e("input:radio",a.revenueModel).change(function(){n(a.priceInput.val())}),a.dynamicPricingToggle.mousedown(function(){o()}).click(function(e){e.preventDefault()}),e(".categorychecklist input:checkbox").on("change",function(){s()}),a.categoryPriceDetails.on("mousedown","a",function(){p(this)}).on("click","a",function(e){e.preventDefault()})},t=function(i){var t,c,s=e(i),p=s.parent("li"),o=s.attr("id");if(!p.hasClass(a.disabled)&&!p.hasClass(a.selected)){if(e("."+a.selected,a.pricingTypeButtonGroup).removeClass(a.selected),p.addClass(a.selected),a.priceSection.removeClass(a.expanded),a.detailsSections.hide(),"lp_js_use-individual-price"===o)a.priceSection.addClass(a.expanded),a.dynamicPricingToggle.show(),a.priceTypeInput.val("individual price"),n(a.priceInput.val()),a.dynamicPricingToggle.text()===lpVars.i18nRemoveDynamicPricing&&(y(),a.individualPriceDetails.show());else if("lp_js_use-category-default-price"===o){d();var u=e(".lp_selected-category a",a.categoriesList);t=u.attr("data-price"),c=u.attr("data-revenue-model"),r(t),l(c,!0),a.priceSection.addClass(a.expanded),a.categoryPriceDetails.show(),a.categories.slideDown(250),a.dynamicPricingToggle.hide(),a.priceTypeInput.val("category default price")}else"lp_js_use-global-default-price"===o&&(t=s.attr("data-price"),c=s.attr("data-revenue-model"),r(t),l(c,!0),a.dynamicPricingToggle.hide(),a.priceTypeInput.val("global default price"));"lp_js_use-individual-price"!==o||a.dynamicPricingToggle.hasClass(a.dynamicPricingApplied)?(a.dynamicPricingToggle.hasClass(a.dynamicPricingApplied)&&g(),a.priceInput.attr("disabled","disabled")):(a.priceInput.removeAttr("disabled"),setTimeout(function(){a.priceInput.focus()},50))}},r=function(e){var i=n(e);a.priceInput.val(i)},l=function(i,t){e("label",a.revenueModel).removeClass(a.selected),t&&e("input:radio[value!="+i+"]",a.revenueModel).parent("label").addClass(a.disabled),e("input:radio[value="+i+"]",a.revenueModel).prop("checked","checked").parent("label").removeClass(a.disabled).addClass(a.selected)},n=function(e){return e=e.toString().replace(/[^0-9\,\.]/g,""),e="string"==typeof e&&e.indexOf(",")>-1?parseFloat(e.replace(",",".")).toFixed(2):parseFloat(e).toFixed(2),isNaN(e)&&(e=0),e=Math.abs(e),e>149.99?e=149.99:e>0&&.05>e&&(e=.05),c(e),e=e.toFixed(2),"de_DE"===lpVars.locale&&(e=e.replace(".",",")),e},c=function(i){var t=e("input:radio:checked",a.revenueModel).val(),r=e("input:radio[value="+a.payPerUse+"]",a.revenueModel),l=e("input:radio[value="+a.singleSale+"]",a.revenueModel);0===i||i>=.05&&5>=i?r.removeAttr("disabled").parent("label").removeClass(a.disabled):r.attr("disabled","disabled").parent("label").addClass(a.disabled),i>=1.49?l.removeAttr("disabled").parent("label").removeClass(a.disabled):l.attr("disabled","disabled").parent("label").addClass(a.disabled),i>5&&t===a.payPerUse?l.prop("checked",!0):1.49>i&&t===a.singleSale&&r.prop("checked",!0),e("label",a.revenueModel).removeClass(a.selected),e("input:radio:checked",a.revenueModel).parent("label").addClass(a.selected)},d=function(){var i=a.categoryInput.val(),t=a.categories.first();if(!a.categories.length)return void a.categoryInput.val("");if("undefined"!=typeof i&&e("[data-category="+i+"]",a.categories.parent()).length?e("[data-category="+i+"]",a.categories.parent()).addClass(a.selectedCategory):(t.addClass(a.selectedCategory),a.categoryInput.val(t.data("category"))),a.categoryPriceButton.hasClass(a.selected)){var n=e(".lp_selected-category a",a.categoriesList),c=n.attr("data-price"),d=n.attr("data-revenue-model");r(c),l(d,!0)}},s=function(){var i,t,n=e("#categorychecklist :checkbox:checked"),c=n.length,s=[],p="";for(i=0;c>i;i++)t=parseInt(n.eq(i).val(),10),s.push(t);e.post(lpVars.ajaxUrl,{action:"laterpay_get_category_prices",form:"laterpay_get_category_prices",category_ids:s},function(i){i&&(i.forEach(function(e){p+='<li data-category="'+e.category_id+'"><a href="#" data-price="'+e.category_price+'" data-revenue-model="'+e.revenue_model+'"><span>'+parseFloat(e.category_price).toFixed(2)+" "+lpVars.currency+"</span>"+e.category_name+"</a></li>"}),a.categoriesList.html(p),i.length?(a.categoryPriceButton.removeClass(a.disabled),a.categories=e("#lp_js_category-price-details li"),d()):(a.categoryPriceButton.addClass(a.disabled),a.detailsSections.hide(),a.categoryPriceButton.hasClass(a.selected)&&(e("."+a.selected,a.pricingTypeButtonGroup).removeClass(a.selected),a.priceSection.removeClass(a.expanded),a.globalPriceButton.hasClass(a.disabled)?(a.individualPriceButton.addClass(a.selected),a.priceTypeInput.val("individual price"),a.dynamicPricingToggle.show(),a.priceInput.removeAttr("disabled"),r(0),l(a.payPerUse,!1)):(a.globalPriceButton.addClass(a.selected),a.priceTypeInput.val("global default price"),r(lpVars.globalDefaultPrice),l(e("a",a.globalPriceButton).attr("data-revenue-model"),!0)))))},"json")},p=function(i){var t=e(i),n=t.parent(),c=n.attr("data-category"),d=t.attr("data-price"),s=t.attr("data-revenue-model");a.categories.removeClass(a.selectedCategory),n.addClass(a.selectedCategory),a.categoryInput.val(c),r(d),l(s,!0)},o=function(){a.dynamicPricingToggle.hasClass(a.dynamicPricingApplied)?(g(),a.revenueModel.show()):u()},u=function(){y(),a.dynamicPricingToggle.addClass(a.dynamicPricingApplied),a.priceInput.attr("disabled","disabled"),a.individualPriceDetails.slideDown(250),a.priceTypeInput.val("individual price, dynamic"),a.dynamicPricingToggle.text(lpVars.i18nRemoveDynamicPricing),a.revenueModel.hide()},g=function(){a.dynamicPricingToggle.removeClass(a.dynamicPricingApplied),a.priceInput.removeAttr("disabled"),a.individualPriceDetails.slideUp(250,function(){e(a.dynamicPricingContainer).empty()}),a.priceTypeInput.val("individual price"),a.dynamicPricingToggle.text(lpVars.i18nAddDynamicPricing)},y=function(){var e=lpVars.dynamicPricingData,i=new LPCurve(a.dynamicPricingContainer);window.lpc=i,a.priceInput.attr("disabled","disabled"),4===e.length?i.set_data(e).setPrice(0,5,lpVars.globalDefaultPrice).plot():i.set_data(e).setPrice(0,5,lpVars.globalDefaultPrice).interpolate("step-before").plot()},_=function(){if(a.dynamicPricingToggle.hasClass(a.dynamicPricingApplied)){var i=window.lpc.get_data();return 4===window.lpc.get_data().length?(e("input[name=laterpay_start_price]").val(i[0].y),e("input[name=laterpay_end_price]").val(i[3].y),e("input[name=laterpay_change_start_price_after_days]").val(i[1].x),e("input[name=laterpay_transitional_period_end_after_days]").val(i[2].x),e("input[name=laterpay_reach_end_price_after_days]").val(i[3].x)):3===window.lpc.get_data().length&&(e("input[name=laterpay_start_price]").val(i[0].y),e("input[name=laterpay_end_price]").val(i[2].y),e("input[name=laterpay_change_start_price_after_days]").val(i[1].x),e("input[name=laterpay_transitional_period_end_after_days]").val(0),e("input[name=laterpay_reach_end_price_after_days]").val(i[2].x)),!0}},v=function(e,a){var i=null;return function(){var t=this,r=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(t,r)},a)}},m=function(){i(),a.dynamicPricingToggle.hasClass(a.dynamicPricingApplied)&&y()};m()}a()})}(jQuery);