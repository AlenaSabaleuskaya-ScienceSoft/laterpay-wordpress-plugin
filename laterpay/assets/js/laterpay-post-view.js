(function(e){e(function(){function t(){var t={postStatisticsPane:e("#lp_js_post-statistics"),postPreviewModeForm:e("#lp_plugin-preview-mode-form"),postPreviewModeToggle:e("#lp_js_toggle-post-preview-mode"),postPreviewModeInput:e("#lp_js_preview-post-input"),postStatisticsVisibilityForm:e("#lp_js_post-statistics-visibility-form"),postStatisticsVisibilityToggle:e("#lp_js_toggle-post-statistics-visibility"),postStatisticsVisibilityInput:e("#lp_js_hide-statistics-pane-input"),postContentPlaceholder:e("#lp_js_post-content-placeholder"),postStatisticsPlaceholder:e("#lp_js_post-statistics-placeholder"),purchaseLink:e(".lp_js_do-purchase"),hidden:"lp_is_hidden"},n=function(){t.postStatisticsPane=e("#lp_js_post-statistics");t.postPreviewModeForm=e("#lp_plugin-preview-mode-form");t.postPreviewModeToggle=e("#lp_js_toggle-post-preview-mode");t.postPreviewModeInput=e("#lp_js_preview-post-input");t.postStatisticsVisibilityForm=e("#lp_js_post-statistics-visibility-form");t.postStatisticsVisibilityToggle=e("#lp_js_toggle-post-statistics-visibility");t.postStatisticsVisibilityInput=e("#lp_js_hide-statistics-pane-input")},r=function(){e("body").on("mousedown",t.purchaseLink,function(){c(this)})},i=function(){t.postStatisticsVisibilityToggle.on("mousedown",function(){u()}).on("click",function(e){e.preventDefault()});t.postPreviewModeToggle.on("change",function(){a()})},s=function(){e.get(lpVars.ajaxUrl,{action:"laterpay_post_statistic_render",post_id:lpVars.post_id,nonce:lpVars.nonces.statistic},function(e){if(e){t.postStatisticsPlaceholder.before(e).remove();o()}})},o=function(){n();i();e(".lp_sparkline-bar",t.postStatisticsPane).peity("bar",{delimiter:";",width:182,height:42,gap:1,fill:function(e,t,n){var r=new Date,i=n.length,s="#999";r.setDate(r.getDate()-(i-t));if(t===i-1){s="#555"}if(r.getDay()===0||r.getDay()===6){s="#c1c1c1"}return s}});e(".lp_sparkline-background-bar",t.postStatisticsPane).peity("bar",{delimiter:";",width:182,height:42,gap:1,fill:function(){return"#ddd"}})},u=function(){var n=t.postStatisticsPane.hasClass(t.hidden)?"0":"1";t.postStatisticsVisibilityInput.val(n);t.postStatisticsPane.toggleClass(t.hidden);e.post(lpVars.ajaxUrl,t.postStatisticsVisibilityForm.serializeArray())},a=function(){if(t.postPreviewModeToggle.prop("checked")){t.postPreviewModeInput.val(1)}else{t.postPreviewModeInput.val(0)}e.post(lpVars.ajaxUrl,t.postPreviewModeForm.serializeArray(),function(){window.location.reload()})},f=function(){e.get(lpVars.ajaxUrl,{action:"laterpay_post_load_purchased_content",post_id:lpVars.post_id,nonce:lpVars.nonces.content},function(e){if(e){t.postContentPlaceholder.html(e)}})},l=function(){e.post(lpVars.ajaxUrl,{action:"laterpay_post_track_views",post_id:lpVars.post_id,nonce:lpVars.nonces.tracking})},c=function(t){if(e(t).data("preview-as-visitor")){alert(lpVars.i18nAlert)}},h=function(){if(e("#lp_js_post-content-placeholder").length===1){f();l()}if(e("#lp_js_post-statistics-placeholder").length===1){s()}r()};h()}t()})})(jQuery);YUI().use("node","laterpay-dialog","laterpay-iframe","laterpay-easyxdm",function(e){var t=e.one(".lp_js_do-purchase"),n={showCloseBtn:true,canSkipAddToInvoice:false},r=new e.LaterPay.DialogManager;if(!t){return}if(t.getData("preview-as-visitor")){e.one(e.config.doc).delegate("click",function(e){e.preventDefault();alert(lpVars.i18nAlert)},".lp_js_do-purchase");return}r.attachToLinks(".lp_js_do-purchase",n.showCloseBtn)})